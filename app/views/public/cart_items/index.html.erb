<h1>ショッピングカート</h1>
<%= link_to "カートを空にする", cart_items_destroy_all_path, method: :delete %>

<table>
    <thead>
      <tr>
        <th>商品名</th>
        <th>単価(税込)</th>
        <th>数量</th>
        <th>小計</th>
        <th colspan="5"></th>
      </tr>
    </thead>
    <tbody>
      <% sum = 0 %>
      <% @cart_items.each do |cart_item| %>
        <% if cart_item.customer_id == current_customer.id then %>
          <tr>
            <td><%= attachment_image_tag @items[(cart_item.item_id)-1], :image, :fill, 50, 50, fallback: "no_image.jpg" %>
                <%= @item_name[(cart_item.item_id) -1] %></td>
            <td><%= (@item_price[(cart_item.item_id) -1]).to_s(:delimited) %></td>
            <td>
              <%= form_with(model: cart_item, local: true) do |f| %>
                <%= f.select :amount, {'1':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':10} %>
                <%= f.submit '変更' %>
              <% end %>
            </td>
                
            <td><%= sum_total = ((@item_price[(cart_item.item_id) -1]) * cart_item.amount).to_s(:delimited) %></td>
            <td><%= link_to "削除する", cart_item_path(cart_item), method: :delete %></td>
          </tr>
          <% sum_total = ((@item_price[(cart_item.item_id) -1]) * cart_item.amount) %>
          <% sum += sum_total %>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <table>
    <thead>
      <tr><th>合計金額</th><td><%= sum.to_s(:delimited) %></td></tr>
    </thead>
    <th colspan="2"></th>
  </table>

  <%= link_to "買い物を続ける", root_path %>

