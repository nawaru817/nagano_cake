<h1>注文履歴詳細</h1>

<h3>注文情報</h3>
<table>
    <thead>
      <tr><th>注文日</th><td><%= @order.created_at %></td></tr>
      <tr><th>配送先</th><td><%= "〒" + (@order.postal_code).to_s.insert(3, "-") %><br><%= @order.address %><br><%= @order.name %></td></tr>
      <tr><th>支払方法</th><td><%=  @order.payment_method %></td></tr>
      <tr><th>注文ステータス</th><td><%= @order.status %></td></tr>
      </tr>
      <th colspan="2"></th>
    </thead>
</table>

<h3>注文内容</h3>
<table>
    <thead>
      <tr>
        <th>商品</th>
        <th>単価（税込）</th>
        <th>個数</th>
        <th>小計</th>
        <th colspan="4"></th>
      </tr>
    </thead>
    <tbody>
      <% sum = 0 %>
      <% @order_details.each do |order_detail| %>
        <% if order_detail.order_id == @order.id then %>
          <tr>
            <td><%= order_detail.item.name %></td>
            <td><%= (order_detail.price * 1.1).floor %></td>
            <td><%= order_detail.amount %></td>
            <td><%= (((order_detail.price * 1.1).floor) * order_detail.amount).to_s(:delimited) %></td>
          </tr>
          <% sum += (((order_detail.price * 1.1).floor) * order_detail.amount) %>
        <% end %>
      <% end %>
    </tbody>
  </table>

<h3>請求情報</h3>
<table>
    <thead>
      <tr><th>商品合計</th><td><%= sum.to_s(:delimited) %></td></tr>
      <tr><th>配送料</th><td><%= @order.shipping_cost %></td></tr>
      <tr><th>ご請求額</th><td><%= (sum + @order.shipping_cost).to_s(:delimited) %></td></tr>
      <th colspan="2"></th>
    </thead>
</table>